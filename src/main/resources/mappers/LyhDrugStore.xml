<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Config 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.gson.prohis.model.mapper.LYH.LyhDrugStoreMapper">
    <resultMap id="drugstore" type="cn.gson.prohis.model.pojos.LyhDrugstoreEntity">
        <id column="drugstore_id" property="drugstoreId"></id>
        <result column="drug_id" property="drugId"></result>
        <result column="drugstore_number" property="drugstoreNumber"></result>
        <result column="drugstore_date" property="drugstoreDate"></result>
        <result column="procurement_id" property="procurementId"></result>
        <result column="audit_id" property="auditId"></result>

        <association property="lyhDrugEntity" javaType="cn.gson.prohis.model.pojos.LyhDrugEntity">
            <id column="drug_id" property="drugId"></id>
            <result column="drug_name" property="drugName"></result>
            <result column="drug_date" property="drugDate"></result>
            <result column="drug_price" property="drugPrice"></result>
            <result column="supplier_id" property="supplierId"></result>

            <association property="lyhSupplierEntity" javaType="cn.gson.prohis.model.pojos.LyhSupplierEntity">
                <id column="supplier_id" property="supplierId"></id>
                <result column="supplier_name" property="supplierName"></result>

            </association>

        </association>
        <association property="lyhProcurementEntity" javaType="cn.gson.prohis.model.pojos.LyhProcurementEntity">
            <id column="procurement_id" property="procurementId"></id>
            <result column="drug_id" property="drugId"></result>
            <result column="procurement_price" property="procurementPrice"></result>
            <result column="procurement_state" property="procurementState"></result>
            <result column="user_name" property="userName"></result>
            <result column="procurement_name" property="procurementName"></result>
            <result column="procurement_date" property="procurementDate"></result>
            <result column="procurement_firstdate" property="procurementFirstdate"></result>
        </association>
        <association property="lyhAuditEntity" javaType="cn.gson.prohis.model.pojos.LyhAuditEntity">
            <id column="audit_id" property="auditId"></id>
            <result column="prescription_id" property="prescriptionId"></result>
            <result column="audit_date" property="auditDate"></result>
            <result column="audit_user" property="auditUser"></result>

        </association>
    </resultMap>


    <select id="findAll" resultMap="drugstore">
        select * from lyhdrugstore a
            left join lyh_drug b on a.drug_id=b.drug_id
            left join lyhprocurement c on a.procurement_id=c.procurement_id
            left join lyhaudit d on a.audit_id=d.audit_id
            left join lyhsupplier e on b.supplier_id=e.supplier_id
        order by a.drugstore_date desc
    </select>

<!--    <update id="updateById" parameterType="LyhDrugstoreEntity">-->
<!--        UPDATE lyhdrugstore a-->
<!--            left join lyhaudit b on a.procurement_id=b.procurement_id-->
<!--            LEFT JOIN lyhprocurementdetails c on b.procurement_id=c.procurement_id-->
<!--            set  a.drugstore_number = a.drugstore_number+#{numbers,jdbcType=INTEGER}-->
<!--        where  b.procurement_id in-->
<!--<foreach collection="procurementId"  item="procurementId" open="(" separator="," close=")">-->
<!--       #{procurementId}-->
<!--</foreach>-->
<!--and c.drug_id in-->
<!--              <foreach collection="drugId" item="drugId" open="(" separator="," close=")">-->
<!--                  #{drugId}-->
<!--              </foreach>-->
<!--    </update>-->



<!--    <update id="updateById" parameterType="cn.gson.prohis.model.pojos.LyhDrugstoreEntity">-->
<!--        <foreach collection="list"  item="item" index="index">-->
<!--        UPDATE lyhdrugstore a-->
<!--        left join lyhaudit b on a.procurement_id=b.procurement_id-->
<!--        LEFT JOIN lyhprocurementdetails c on b.procurement_id=c.procurement_id-->
<!--        set  a.drugstore_number = a.drugstore_number+#{item.numbers,jdbcType=INTEGER}-->
<!--        where  b.procurement_id =  #{item.procurementId}-->
<!--        and c.drug_id = #{item.drugId}-->
<!--        </foreach>-->
<!--    </update>-->




    <update id="updateById" >
            UPDATE lyhdrugstore a
            left join lyhaudit b on a.procurement_id=b.procurement_id
            LEFT JOIN lyhprocurementdetails c on b.procurement_id=c.procurement_id
            set  a.drugstore_number = a.drugstore_number+#{numbers,jdbcType=INTEGER}
            where
          a.drug_id = #{drugId}
            and
               a.procurement_id =  #{procurementId}
    </update>


</mapper>